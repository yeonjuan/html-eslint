name: Package Manager Test

on:
  pull_request:
    branches: [main]
  push:
    branches: [main]

jobs:
  test-npm:
    name: Test with npm
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: "20"

      - name: Enable Corepack
        run: corepack enable

      - name: Install dependencies
        run: yarn install --immutable

      - name: Build packages
        run: yarn build

      - name: Install with npm
        run: |
          cd .github/workflows/fixtures/npm/html
          npm install

      - name: Run ESLint
        run: |
          cd .github/workflows/fixtures/npm/html
          npx eslint test.html

  test-npm-react:
    name: Test with npm (React)
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: "20"

      - name: Enable Corepack
        run: corepack enable

      - name: Install dependencies
        run: yarn install --immutable

      - name: Build packages
        run: yarn build

      - name: Install with npm
        run: |
          cd .github/workflows/fixtures/npm/react
          npm install

      - name: Run ESLint
        run: |
          cd .github/workflows/fixtures/npm/react
          npx eslint test.jsx

  test-pnpm:
    name: Test with pnpm
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: "20"

      - name: Enable Corepack
        run: corepack enable

      - name: Install dependencies
        run: yarn install --immutable

      - name: Build packages
        run: yarn build

      - name: Install with pnpm
        run: |
          cd .github/workflows/fixtures/pnpm/html
          corepack prepare pnpm@9.15.4 --activate
          pnpm install

      - name: Run ESLint
        run: |
          cd .github/workflows/fixtures/pnpm/html
          pnpm exec eslint test.html

  test-pnpm-react:
    name: Test with pnpm (React)
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: "20"

      - name: Enable Corepack
        run: corepack enable

      - name: Install dependencies
        run: yarn install --immutable

      - name: Build packages
        run: yarn build

      - name: Install with pnpm
        run: |
          cd .github/workflows/fixtures/pnpm/react
          corepack prepare pnpm@9.15.4 --activate
          pnpm install

      - name: Run ESLint
        run: |
          cd .github/workflows/fixtures/pnpm/react
          pnpm exec eslint test.jsx

  test-yarn:
    name: Test with Yarn
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: "20"

      - name: Enable Corepack
        run: corepack enable

      - name: Install dependencies
        run: yarn install --immutable

      - name: Build packages
        run: yarn build

      - name: Install with Yarn
        run: |
          cd .github/workflows/fixtures/yarn/html
          corepack enable
          yarn set version stable
          yarn install

      - name: Run ESLint
        run: |
          cd .github/workflows/fixtures/yarn/html
          yarn eslint test.html

  test-yarn-react:
    name: Test with Yarn (React)
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: "20"

      - name: Enable Corepack
        run: corepack enable

      - name: Install dependencies
        run: yarn install --immutable

      - name: Build packages
        run: yarn build

      - name: Install with Yarn
        run: |
          cd .github/workflows/fixtures/yarn/react
          corepack enable
          yarn set version stable
          yarn install

      - name: Run ESLint
        run: |
          cd .github/workflows/fixtures/yarn/react
          yarn eslint test.jsx
